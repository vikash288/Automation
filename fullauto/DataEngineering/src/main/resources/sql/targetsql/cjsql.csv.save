Affiliate Name,Step 1,Step 2,Step 3,Step 4 ,Step 5,Flag
CJ,"Insert ignore into UPC_COMMON_ID_MAP2 Select TGT.COMMON_ID, SRC.UPC, SRC.Retailer_code, SRC.ITEM_ID,NOW() from (SELECT FIELD_11 AS UPC, $Y AS RETAILER_CODE, FIELD_8 AS ITEM_ID FROM $X  WHERE FIELD_11 <> 'UPC' AND FIELD_11 IS NOT NULL AND FIELD_11 <> ' ' AND FIELD_11 REGEXP '^[0-9]+$' GROUP BY UPC, RETAILER_CODE ) SRC JOIN UPC_COMMON_ID_MAP2 TGT ON SRC.UPC = TGT.UPC and TGT.RETAILER_CODE <> $Y and TGT.RETAILER_CODE is null group by 1,2,3,4;
",Truncate UPC_COMMON_ID_MAP_W3,"Insert ignore into UPC_COMMON_ID_MAP_W3 ( UPC,  RETAILER_CODE, ITEM_ID,AUDITTIME ) Select SRC.UPC, SRC.Retailer_code, SRC.ITEM_ID,NOW() from (SELECT FIELD_11 AS UPC, $Y AS RETAILER_CODE,FIELD_8 AS ITEM_ID FROM $X WHERE FIELD_11 <> 'UPC' AND FIELD_11 IS NOT NULL AND FIELD_11 <> ' ' AND FIELD_11 REGEXP '^[0-9]+$' GROUP BY UPC, RETAILER_CODE ) SRC LEFT JOIN UPC_COMMON_ID_MAP2 TGT ON SRC.UPC = TGT.UPC where TGT.UPC is null; 
","Insert ignore into UPC_COMMON_ID_MAP2 Select common_id + (Select max(common_id) from UPC_COMMON_ID_MAP2), upc, retailer_code, ITEM_ID ,AUDITTIME from UPC_COMMON_ID_MAP_W3;
","create table $Z ignore select a.FIELD_8 as ITEM_ID,  a.FIELD_5 as TITLE, a.FIELD_7 as DESCRIPTION, '' as COLOR, '' as SIZE, a.FIELD_11 as UPC,  a.FIELD_18 as PRODUCT_URL, a.FIELD_20 as IMAGE_URL, a.FIELD_18 as AFFILIATE_URL, b.common_id as PRICE_ID, a.FIELD_14 + ' ' AS PRICE1, a.FIELD_15 + ' ' AS PRICE2, a.FIELD_38 as , a.FIELD_10 as MPN, a.FIELD_9 as MANUFACTURER, a.FIELD_6 as KEYWORDS, a.FIELD_23 as CATEGORY_BREADCRUMB, '' as GENDER , '' as BRAND , NOW() as TIMEAUDIT from $X a, UPC_COMMON_ID_MAP2 b where a.FIELD_11 = b.upc and b.retailer_code =$Y and a.FIELD_11 <> 'UPC'  and a.FIELD_11 is not null and a.FIELD_11 REGEXP   '^[0-9]+$'  and a.FIELD_11 <> ' ' and length(a.FIELD_11) < 51  ;",1
