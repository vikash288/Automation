Affiliate Name,Step 1,Step 2,Step 3,Step 4 ,Step 5,Flag
Papperjam,"Insert into UPC_COMMON_ID_MAP2
 Select TGT.COMMON_ID, SRC.UPC, SRC.Retailer_code, SRC.ITEM_ID from
(SELECT
    FIELD_68 AS UPC,
    $Y AS RETAILER_CODE,
    FIELD_64 AS ITEM_ID
  FROM $X
  WHERE FIELD_68 <> 'UPC' AND FIELD_68 IS NOT NULL AND FIELD_68 <> ' ' AND FIELD_68 REGEXP '^[0-9]+$'  
  GROUP BY UPC, RETAILER_CODE
) SRC
JOIN UPC_COMMON_ID_MAP2 TGT
ON SRC.UPC = TGT.UPC
and TGT.RETAILER_CODE <> $Y
group by 1,2,3,4
;",Truncate UPC_COMMON_ID_MAP_W3,"Insert into UPC_COMMON_ID_MAP_W3 (
  UPC,
  RETAILER_CODE,
  ITEM_ID
)
 Select SRC.UPC, SRC.Retailer_code, SRC.ITEM_ID from
(SELECT
    FIELD_68 AS UPC,
    $Y AS RETAILER_CODE,
    FIELD_64 AS ITEM_ID
  FROM $X
  WHERE FIELD_68 <> 'UPC' AND FIELD_68 IS NOT NULL AND FIELD_68 <> ' '  AND FIELD_68 REGEXP '^[0-9]+$' 
 GROUP BY UPC, RETAILER_CODE
) SRC
LEFT JOIN UPC_COMMON_ID_MAP2 TGT
ON SRC.UPC = TGT.UPC
where TGT.UPC is null
;","Insert into UPC_COMMON_ID_MAP2
Select common_id + (Select max(common_id) from UPC_COMMON_ID_MAP2), upc, retailer_code, ITEM_ID
from UPC_COMMON_ID_MAP_W3;","create table $Z 
select
  a.FIELD_64 as ITEM_ID,
  a.FIELD_42 as TITLE,
  a.FIELD_68 as UPC,
  a.FIELD_10 as PRODUCT_URL,
  a.FIELD_27 as IMAGE_URL,
  a.FIELD_10 as AFFILIATE_URL,
  b.common_id as PRICE_ID,
  a.FIELD_46 + ' ' AS PRICE1,
  a.FIELD_81 + ' ' AS PRICE2
from $X a, UPC_COMMON_ID_MAP2 b
where a.FIELD_68 = b.upc
and b.retailer_code = $Y
and a.FIELD_68 <> 'UPC'
and a.FIELD_68 is not null
and a.FIELD_68 <> ' ' and a.FIELD_68 REGEXP '^[0-9]+$' 
and length(a.FIELD_68) < 51 ;",1
